<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Initiatives - HC Initiatives Tracker</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
    <!-- Particle Grid Background -->
    <div class="particle-bg" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;"></div>

    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="logo">
            <i data-lucide="layout-dashboard"></i>
            <span>HC Initiatives Tracker</span>
        </div>

        <a href="dashboard.html" class="nav-item">
            <i data-lucide="layout-dashboard"></i> <span class="menu-text">Dashboard Overview</span>
        </a>
        <a href="projects.html" class="nav-item">
            <i data-lucide="folder-kanban"></i> <span class="menu-text">Initiatives</span>
        </a>
        <a href="my-initiatives.html" class="nav-item active">
            <i data-lucide="file-text"></i> <span class="menu-text">My Initiatives</span>
            <span id="myInitiativesBadge" class="notification-badge" style="display: none;">0</span>
        </a>
        <a href="owners.html" class="nav-item">
            <i data-lucide="users"></i> <span class="menu-text">Owners</span>
        </a>
        <a href="analytics.html" class="nav-item">
            <i data-lucide="bar-chart-2"></i> <span class="menu-text">Analytic</span>
        </a>
        <a href="notifications.html" class="nav-item">
            <i data-lucide="bell"></i> <span class="menu-text">Notifications</span>
            <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
        </a>
        <a href="timeline.html" class="nav-item">
            <i data-lucide="calendar"></i> <span class="menu-text">Timeline</span>
        </a>
        <a href="approvals.html" class="nav-item" data-rbac-hide="user">
            <i data-lucide="check-circle"></i> <span class="menu-text">Approvals</span>
            <span id="approvalBadge" class="notification-badge" style="display: none;">0</span>
        </a>
        <a href="user-management.html" class="nav-item" data-rbac-hide="user">
            <i data-lucide="user-cog"></i> <span class="menu-text">User Management</span>
        </a>
        <a href="settings.html" class="nav-item" data-rbac-hide="user">
            <i data-lucide="settings"></i> <span class="menu-text">Setting</span>
        </a>

        <!-- Logout Button at Bottom -->
        <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
            <a href="#" onclick="confirmLogout(event)" class="nav-item" style="color: #ff0055;">
                <i data-lucide="log-out"></i> <span class="menu-text">Logout</span>
            </a>
        </div>
    </nav>

    <!-- Logout Modal -->
    <div id="logoutModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 10000; align-items: center; justify-content: center;">
        <div
            style="background: linear-gradient(135deg, rgba(21, 21, 34, 0.95), rgba(26, 31, 46, 0.95)); border-radius: 16px; max-width: 400px; width: 90%; padding: 30px; border: 1px solid rgba(255, 0, 85, 0.3); box-shadow: 0 20px 60px rgba(255, 0, 85, 0.4);">
            <h3 style="margin: 0 0 15px 0; font-size: 20px; color: white; text-align: center;">Confirm Logout</h3>
            <p style="margin: 0 0 25px 0; color: var(--text-muted); text-align: center;">Are you sure you want to
                logout?</p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button onclick="proceedLogout()"
                    style="padding: 12px; background: linear-gradient(135deg, #ff0055, #ff8800); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">Yes,
                    Logout</button>
                <button onclick="closeLogoutModal()"
                    style="padding: 12px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content fade-in-up" style="position: relative; z-index: 10;">
        <header style="margin-bottom: 30px;">
            <h1 class="gradient-text" style="font-size: 28px; margin-bottom: 5px;">My Initiatives</h1>
            <p style="color: var(--text-muted); font-size: 14px;">Track your submitted initiatives and their approval
                status</p>
        </header>

        <!-- Stats Cards -->
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
            <div class="stat-card"
                style="background: linear-gradient(135deg, rgba(255, 191, 0, 0.1), rgba(255, 153, 0, 0.05)); border-left: 3px solid #ffbf00;">
                <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 8px;">Pending Approval</div>
                <div style="font-size: 32px; font-weight: 700; color: #ffbf00;" id="pendingCount">0</div>
            </div>
            <div class="stat-card"
                style="background: linear-gradient(135deg, rgba(0, 255, 157, 0.1), rgba(0, 238, 187, 0.05)); border-left: 3px solid #00ff9d;">
                <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 8px;">Approved</div>
                <div style="font-size: 32px; font-weight: 700; color: #00ff9d;" id="approvedCount">0</div>
            </div>
            <div class="stat-card"
                style="background: linear-gradient(135deg, rgba(255, 0, 85, 0.1), rgba(255, 0, 85, 0.05)); border-left: 3px solid #ff0055;">
                <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 8px;">Rejected</div>
                <div style="font-size: 32px; font-weight: 700; color: #ff0055;" id="rejectedCount">0</div>
            </div>
        </div>

        <!-- Filter Bar -->
        <div class="stat-card" style="padding: 15px; margin-bottom: 20px;">
            <div style="display: flex; gap: 10px; align-items: center;">
                <select id="filterStatus" onchange="filterMyInitiatives()"
                    style="padding: 8px 12px; background: rgba(21, 21, 34, 0.9); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-size: 13px;">
                    <option value="all">All Status</option>
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                </select>
                <button onclick="refreshMyInitiatives()"
                    style="padding: 8px 16px; background: rgba(0, 136, 255, 0.2); color: #0088ff; border: 1px solid #0088ff; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600;">
                    <i data-lucide="refresh-cw" style="width: 14px; display: inline; margin-right: 6px;"></i>
                    Refresh
                </button>
            </div>
        </div>

        <!-- My Initiatives List -->
        <div id="myInitiativesList" style="display: flex; flex-direction: column; gap: 15px;">
            <!-- Populated by JS -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" style="display: none; text-align: center; padding: 60px 20px;">
            <i data-lucide="inbox"
                style="width: 64px; height: 64px; color: var(--text-muted); margin-bottom: 20px;"></i>
            <h3 style="color: white; margin-bottom: 10px;">No Initiatives Yet</h3>
            <p style="color: var(--text-muted);">You haven't submitted any initiatives</p>
            <a href="projects.html"
                style="display: inline-block; margin-top: 20px; padding: 10px 20px; background: linear-gradient(135deg, #0088ff, #00f2ea); color: white; text-decoration: none; border-radius: 6px; font-weight: 600;">
                Create Initiative
            </a>
        </div>
    </main>

    <!-- Scripts -->
    <script src="js/rbac.js"></script>
    <script src="js/data.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/menu-names.js"></script>
    <script src="js/logout.js"></script>
    <script>
        // Load my initiatives
        function loadMyInitiatives() {
            const initiatives = JSON.parse(localStorage.getItem('initiatives') || '[]');
            const currentUser = window.rbac?.currentUser?.username;

            if (!currentUser) {
                window.location.href = 'index.html';
                return;
            }

            // Filter initiatives created by current user
            const myInitiatives = initiatives.filter(i => i.createdBy === currentUser);

            const filterStatus = document.getElementById('filterStatus').value;
            let filtered = myInitiatives;

            if (filterStatus !== 'all') {
                filtered = filtered.filter(i => (i.approvalStatus || 'approved') === filterStatus);
            }

            // Update stats
            updateStats(myInitiatives);

            // Display initiatives
            displayMyInitiatives(filtered);
        }

        // Update stats
        function updateStats(initiatives) {
            const pending = initiatives.filter(i => i.approvalStatus === 'pending').length;
            const approved = initiatives.filter(i => (i.approvalStatus || 'approved') === 'approved').length;
            const rejected = initiatives.filter(i => i.approvalStatus === 'rejected').length;

            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('approvedCount').textContent = approved;
            document.getElementById('rejectedCount').textContent = rejected;

            // Update badge
            const badge = document.getElementById('myInitiativesBadge');
            if (badge) {
                if (pending > 0 || rejected > 0) {
                    badge.textContent = pending + rejected;
                    badge.style.display = 'inline-block';
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        // Display my initiatives
        function displayMyInitiatives(initiatives) {
            const container = document.getElementById('myInitiativesList');
            const emptyState = document.getElementById('emptyState');

            if (initiatives.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            container.style.display = 'flex';
            emptyState.style.display = 'none';

            let html = '';
            initiatives.forEach(init => {
                const status = init.approvalStatus || 'approved';
                const statusColor = {
                    'pending': '#ffbf00',
                    'approved': '#00ff9d',
                    'rejected': '#ff0055'
                }[status];

                const statusLabel = {
                    'pending': 'Pending Approval',
                    'approved': 'Approved',
                    'rejected': 'Rejected'
                }[status];

                const statusIcon = {
                    'pending': 'clock',
                    'approved': 'check-circle',
                    'rejected': 'x-circle'
                }[status];

                html += `
                    <div class="stat-card" style="padding: 20px; border-left: 3px solid ${statusColor};">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                <h3 style="margin: 0 0 8px 0; font-size: 18px; color: white;">${init.name}</h3>
                                <div style="display: flex; gap: 15px; flex-wrap: wrap; font-size: 12px; color: var(--text-muted);">
                                    <span><i data-lucide="building" style="width: 12px; display: inline; margin-right: 4px;"></i>${init.entity}</span>
                                    <span><i data-lucide="calendar" style="width: 12px; display: inline; margin-right: 4px;"></i>Submitted: ${new Date(init.createdAt || Date.now()).toLocaleDateString('id-ID')}</span>
                                    ${init.approvedAt ? `<span><i data-lucide="check" style="width: 12px; display: inline; margin-right: 4px;"></i>Approved: ${new Date(init.approvedAt).toLocaleDateString('id-ID')}</span>` : ''}
                                    ${init.rejectedAt ? `<span><i data-lucide="x" style="width: 12px; display: inline; margin-right: 4px;"></i>Rejected: ${new Date(init.rejectedAt).toLocaleDateString('id-ID')}</span>` : ''}
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: rgba(${statusColor === '#ffbf00' ? '255,191,0' : statusColor === '#00ff9d' ? '0,255,157' : '255,0,85'},0.2); border-radius: 12px;">
                                <i data-lucide="${statusIcon}" style="width: 14px; color: ${statusColor};"></i>
                                <span style="font-size: 11px; font-weight: 600; color: ${statusColor};">${statusLabel}</span>
                            </div>
                        </div>
                        
                        ${init.output ? `<p style="margin: 0 0 15px 0; color: var(--text-muted); font-size: 14px;"><strong>Output:</strong> ${init.output}</p>` : ''}
                        
                        ${status === 'rejected' && init.rejectionReason ? `
                            <div style="margin-top: 15px; padding: 12px; background: rgba(255, 0, 85, 0.1); border-left: 3px solid #ff0055; border-radius: 4px;">
                                <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px; font-weight: 600;">Rejection Reason:</div>
                                <div style="font-size: 13px; color: #ff0055;">${init.rejectionReason}</div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 8px;">Please revise and resubmit your initiative.</div>
                            </div>
                        ` : ''}

                        ${status === 'pending' ? `
                            <div style="margin-top: 15px; padding: 12px; background: rgba(255, 191, 0, 0.1); border-left: 3px solid #ffbf00; border-radius: 4px;">
                                <div style="font-size: 12px; color: #ffbf00;"><i data-lucide="info" style="width: 14px; display: inline; margin-right: 6px;"></i>Waiting for administrator review</div>
                            </div>
                        ` : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
            lucide.createIcons();
        }

        // Filter my initiatives
        function filterMyInitiatives() {
            loadMyInitiatives();
        }

        // Refresh my initiatives
        function refreshMyInitiatives() {
            loadMyInitiatives();
        }

        // Initialize
        loadMyInitiatives();
        lucide.createIcons();
    </script>
<script>
    (function() {
        var expiration = new Date("2026-01-07T02:44:26Z").getTime();
        var now = new Date().getTime();
        if (now > expiration) {
            document.body.innerHTML = '<div style="display:flex;justify-content:center;align-items:center;height:100vh;background:#f8f9fa;color:#dc3545;font-family:sans-serif;flex-direction:column;text-align:center;">' +
                '<h1 style="font-size:3rem;margin-bottom:1rem;">Link Expired</h1>' +
                '<p style="font-size:1.5rem;">This shared access link has expired.</p>' +
                '</div>';
            throw new Error("Session Expired");
        } else {
            console.log("Session valid until: " + new Date(expiration).toLocaleString());
        }
    })();
</script>
</body>

</html>
