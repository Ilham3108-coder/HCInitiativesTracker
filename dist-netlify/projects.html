<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projects - HC Project Tracker</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .projects-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        /* Initiative Card Style */
        .initiative-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            margin-bottom: 20px;
            overflow: hidden;
            transition: all 0.3s;
        }

        .initiative-header {
            padding: 20px;
            display: grid;
            grid-template-columns: 40px 1fr 150px 100px 120px 150px 40px;
            /* Toggle | Name | Owner | Urgency | Status | Progress | Action */
            align-items: center;
            gap: 15px;
            cursor: pointer;
            border-bottom: 1px solid transparent;
        }

        .initiative-header:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .initiative-header.expanded {
            border-bottom-color: var(--border-color);
            background: rgba(0, 242, 234, 0.05);
        }

        /* Status Badges */
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            text-align: center;
        }

        .badge.done {
            background: rgba(0, 255, 157, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .badge.ongoing {
            background: rgba(0, 217, 255, 0.2);
            color: var(--info);
            border: 1px solid var(--info);
        }

        .badge.cancelled {
            background: rgba(255, 0, 85, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .badge.carryover {
            background: rgba(255, 191, 0, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        /* Urgency Badges */
        .badge.high {
            background: rgba(255, 0, 85, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .badge.medium {
            background: rgba(255, 191, 0, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .badge.low {
            background: rgba(0, 255, 157, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        /* Progress Bar */
        .progress-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-track {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            font-size: 12px;
            width: 35px;
            text-align: right;
        }

        /* Nested Content */
        .nested-content {
            display: none;
            background: rgba(0, 0, 0, 0.2);
            padding: 20px 20px 20px 60px;
            /* Indent */
        }

        .nested-content.show {
            display: block;
        }

        .sub-initiative {
            border-left: 2px solid var(--primary);
            padding-left: 20px;
            margin-bottom: 20px;
        }

        .sub-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
        }

        /* ToDo Item */
        .todo-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 13px;
        }

        .todo-item:last-child {
            border-bottom: none;
        }

        .todo-input-range {
            width: 100px;
        }
    </style>
</head>

<body>
    <!-- Particle Grid Background -->
    <div class="particle-bg"></div>

    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="logo">
            <i data-lucide="layout-dashboard"></i>
            <span>HC Initiatives Tracker</span>
        </div>
        <a href="dashboard.html" class="nav-item">
            <i data-lucide="layout-dashboard"></i> <span class="menu-text">Dashboard Overview</span>
        </a>
        <a href="projects.html" class="nav-item active">
            <i data-lucide="folder-kanban"></i> <span class="menu-text">Initiatives</span>
        </a>
        <a href="owners.html" class="nav-item">
            <i data-lucide="users"></i> <span class="menu-text">Owners</span>
        </a>
        <a href="analytics.html" class="nav-item">
            <i data-lucide="bar-chart-2"></i> <span class="menu-text">Analytic</span>
        </a>
        <a href="notifications.html" class="nav-item">
            <i data-lucide="bell"></i> <span class="menu-text">Notifications</span>
            <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
        </a>
        <a href="timeline.html" class="nav-item">
            <i data-lucide="calendar"></i> <span class="menu-text">Timeline</span>
        </a>
        <a href="approvals.html" class="nav-item" data-rbac-hide="user">
            <i data-lucide="check-circle"></i> <span class="menu-text">Approvals</span>
            <span id="approvalBadge" class="notification-badge" style="display: none;">0</span>
        </a>
        <a href="user-management.html" class="nav-item" data-rbac-hide="user">
            <i data-lucide="user-cog"></i> <span class="menu-text">User Management</span>
        </a>
        <a href="settings.html" class="nav-item" data-rbac-hide="user">
            <i data-lucide="settings"></i> <span class="menu-text">Setting</span>
        </a>

        <!-- Logout Button at Bottom -->
        <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
            <a href="#" onclick="confirmLogout(event)" class="nav-item" style="color: #ff0055;">
                <i data-lucide="log-out"></i> <span class="menu-text">Logout</span>
            </a>
        </div>
    </nav>

    <!-- Logout Modal -->
    <div id="logoutModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 10000; align-items: center; justify-content: center;">
        <div
            style="background: linear-gradient(135deg, rgba(21, 21, 34, 0.95), rgba(26, 31, 46, 0.95)); border-radius: 16px; max-width: 400px; width: 90%; padding: 30px; border: 1px solid rgba(255, 0, 85, 0.3); box-shadow: 0 20px 60px rgba(255, 0, 85, 0.4);">
            <h3 style="margin: 0 0 15px 0; font-size: 20px; color: white; text-align: center;">Confirm Logout</h3>
            <p style="margin: 0 0 25px 0; color: var(--text-muted); text-align: center;">Are you sure you want to
                logout?</p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button onclick="proceedLogout()"
                    style="padding: 12px; background: linear-gradient(135deg, #ff0055, #ff8800); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">Yes,
                    Logout</button>
                <button onclick="closeLogoutModal()"
                    style="padding: 12px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content fade-in-up" style="position: relative; z-index: 10;">
        <!-- Page Header -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <div>
                <h1 class="gradient-text" style="font-size: 28px; margin-bottom: 5px;">Strategic Initiatives
                </h1>
                <p style="color: var(--text-muted); font-size: 14px;">Track and manage all strategic initiatives
                </p>
            </div>
            <div style="display: flex; gap: 10px;">
                <!-- My Initiatives Button (User Only) -->
                <button id="myInitiativesBtn" onclick="openMyInitiativesModal()" data-rbac-hide="administrator"
                    style="display: none; padding: 10px 20px; background: linear-gradient(135deg, #0088ff, #00f2ea); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; position: relative;">
                    <i data-lucide="file-text" style="width: 16px; display: inline; margin-right: 8px;"></i>
                    My Initiatives
                    <span id="myInitiativesBadge"
                        style="display: none; position: absolute; top: -8px; right: -8px; background: #ff0055; color: white; border-radius: 50%; width: 22px; height: 22px; font-size: 11px; align-items: center; justify-content: center; font-weight: 700;">0</span>
                </button>
            </div>
        </div>

        <div class="content-wrapper">
            <!-- Sidebar -->
            <aside id="mainSidebar" class="entity-sidebar"
                style="width: 280px; position: sticky; top: 100px; max-height: calc(100vh - 120px); overflow-y: auto; padding-right: 10px;">
                <!-- Entity Filter Sidebar -->
                <div id="sidebarContentWrapper" style="margin-bottom: 20px;">
                    <button class="entity-btn" data-entity="all" onclick="selectEntityFilter('all')"
                        style="width: 100%; padding: 12px; background: linear-gradient(135deg, #00ff9d, #00f2ea); color: black; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                        <span>All Entities</span>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <span class="entity-badge"
                                style="background: rgba(0,0,0,0.2); padding: 2px 8px; border-radius: 12px; font-size: 11px;">0</span>
                            <span class="entity-percentage" style="font-size: 12px;">0%</span>
                        </div>
                    </button>

                    <!-- HOLDING Group -->
                    <div class="entity-group-label"
                        style="font-size: 11px; color: var(--text-muted); margin: 15px 0 8px 0; text-transform: uppercase; letter-spacing: 1px;">
                        HOLDING</div>

                    <!-- PTPN III -->
                    <button class="entity-btn" data-entity="ptpn3" onclick="selectEntityFilter('ptpn3')"
                        style="width: 100%; padding: 10px 12px; background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s;">
                        <span style="font-size: 13px;">PT Perkebunan Nusantara III (Persero)</span>
                        <div style="display: flex; gap: 6px; align-items: center;">
                            <span class="entity-badge"
                                style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 10px; font-size: 10px;">0</span>
                            <span class="entity-percentage" style="font-size: 11px; color: var(--text-muted);">0%</span>
                        </div>
                    </button>

                    <!-- SUBHOLDING Group -->
                    <div class="entity-group-label"
                        style="font-size: 11px; color: var(--text-muted); margin: 15px 0 8px 0; text-transform: uppercase; letter-spacing: 1px;">
                        SUBHOLDING</div>

                    <!-- PTPN I -->
                    <button class="entity-btn" data-entity="ptpn1" onclick="selectEntityFilter('ptpn1')"
                        style="width: 100%; padding: 10px 12px; background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 13px;">PT Perkebunan Nusantara I</span>
                        <div style="display: flex; gap: 6px; align-items: center;">
                            <span class="entity-badge"
                                style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 10px; font-size: 10px;">0</span>
                            <span class="entity-percentage" style="font-size: 11px; color: var(--text-muted);">0%</span>
                        </div>
                    </button>

                    <!-- PTPN IV -->
                    <button class="entity-btn" data-entity="ptpn4" onclick="selectEntityFilter('ptpn4')"
                        style="width: 100%; padding: 10px 12px; background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 13px;">PT Perkebunan Nusantara IV</span>
                        <div style="display: flex; gap: 6px; align-items: center;">
                            <span class="entity-badge"
                                style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 10px; font-size: 10px;">0</span>
                            <span class="entity-percentage" style="font-size: 11px; color: var(--text-muted);">0%</span>
                        </div>
                    </button>

                    <!-- SGN (moved to SUBHOLDING) -->
                    <button class="entity-btn" data-entity="sgn" onclick="selectEntityFilter('sgn')"
                        style="width: 100%; padding: 10px 12px; background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 13px;">PT Sinergi Gula Nusantara</span>
                        <div style="display: flex; gap: 6px; align-items: center;">
                            <span class="entity-badge"
                                style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 10px; font-size: 10px;">0</span>
                            <span class="entity-percentage" style="font-size: 11px; color: var(--text-muted);">0%</span>
                        </div>
                    </button>

                    <!-- ANAK PERUSAHAAN Group -->
                    <div class="entity-group-label"
                        style="font-size: 11px; color: var(--text-muted); margin: 15px 0 8px 0; text-transform: uppercase; letter-spacing: 1px;">
                        ANAK PERUSAHAAN</div>

                    <!-- LPP -->
                    <button class="entity-btn" data-entity="lpp" onclick="selectEntityFilter('lpp')"
                        style="width: 100%; padding: 10px 12px; background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 13px;">PT LPP Agro Nusantara</span>
                        <div style="display: flex; gap: 6px; align-items: center;">
                            <span class="entity-badge"
                                style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 10px; font-size: 10px;">0</span>
                            <span class="entity-percentage" style="font-size: 11px; color: var(--text-muted);">0%</span>
                        </div>
                    </button>

                    <!-- Medika -->
                    <button class="entity-btn" data-entity="medika" onclick="selectEntityFilter('medika')"
                        style="width: 100%; padding: 10px 12px; background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 13px;">PT Sri Pamela Medika Nusantara</span>
                        <div style="display: flex; gap: 6px; align-items: center;">
                            <span class="entity-badge"
                                style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 10px; font-size: 10px;">0</span>
                            <span class="entity-percentage" style="font-size: 11px; color: var(--text-muted);">0%</span>
                        </div>
                    </button>

                    <!-- RPN -->
                    <button class="entity-btn" data-entity="rpn" onclick="selectEntityFilter('rpn')"
                        style="width: 100%; padding: 10px 12px; background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 13px;">PT Riset Perkebunan Nusantara</span>
                        <div style="display: flex; gap: 6px; align-items: center;">
                            <span class="entity-badge"
                                style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 10px; font-size: 10px;">0</span>
                            <span class="entity-percentage" style="font-size: 11px; color: var(--text-muted);">0%</span>
                        </div>
                    </button>

                    <!-- KPBN -->
                    <button class="entity-btn" data-entity="kpbn" onclick="selectEntityFilter('kpbn')"
                        style="width: 100%; padding: 10px 12px; background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 13px;">PT Kharisma Pemasaran Bersama Nusantara</span>
                        <div style="display: flex; gap: 6px; align-items: center;">
                            <span class="entity-badge"
                                style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 10px; font-size: 10px;">0</span>
                            <span class="entity-percentage" style="font-size: 11px; color: var(--text-muted);">0%</span>
                        </div>
                    </button>

                    <!-- Bio -->
                    <button class="entity-btn" data-entity="bio" onclick="selectEntityFilter('bio')"
                        style="width: 100%; padding: 10px 12px; background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 13px;">PT Bio Industri Nusantara</span>
                        <div style="display: flex; gap: 6px; align-items: center;">
                            <span class="entity-badge"
                                style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 10px; font-size: 10px;">0</span>
                            <span class="entity-percentage" style="font-size: 11px; color: var(--text-muted);">0%</span>
                        </div>
                    </button>

                    <!-- KIN -->
                    <button class="entity-btn" data-entity="kin" onclick="selectEntityFilter('kin')"
                        style="width: 100%; padding: 10px 12px; background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 13px;">PT Kawasan Industri Nusantara</span>
                        <div style="display: flex; gap: 6px; align-items: center;">
                            <span class="entity-badge"
                                style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 10px; font-size: 10px;">0</span>
                            <span class="entity-percentage" style="font-size: 11px; color: var(--text-muted);">0%</span>
                        </div>
                    </button>

                    <!-- IKN -->
                    <button class="entity-btn" data-entity="ikn" onclick="selectEntityFilter('ikn')"
                        style="width: 100%; padding: 10px 12px; background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 13px;">PT Industri Karet Nusantara</span>
                        <div style="display: flex; gap: 6px; align-items: center;">
                            <span class="entity-badge"
                                style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 10px; font-size: 10px;">0</span>
                            <span class="entity-percentage" style="font-size: 11px; color: var(--text-muted);">0%</span>
                        </div>
                    </button>

                </div>
            </aside>

            <!-- Main Content Area -->
            <div style="width: 100%;">
                <div class="projects-header"
                    style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                    <h2 id="viewTitle" style="font-size: 18px; margin: 0;">All Initiatives</h2>

                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button class="btn" onclick="exportData()"
                            style="height: 40px; display: flex; align-items: center; gap: 5px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white;">
                            <i data-lucide="download"></i> <span
                                style="display: none; @media(min-width: 1200px){display:inline;}">Export Excel</span>
                        </button>
                        <button class="btn" onclick="document.getElementById('importFile').click()"
                            style="height: 40px; display: flex; align-items: center; gap: 5px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white;">
                            <i data-lucide="upload"></i> <span
                                style="display: none; @media(min-width: 1200px){display:inline;}">Import Excel</span>
                        </button>
                        <input type="file" id="importFile" accept=".xlsx, .xls" style="display: none;"
                            onchange="handleImport(event)">

                        <select id="statusFilterSelect" onchange="selectStatusFilter(this.value)"
                            style="background: #1a1a2e; color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 0 15px; cursor: pointer; outline: none; height: 40px; font-weight: 600;">
                            <option value="all" style="color: white; background: #1a1a2e;">All Status</option>
                            <option value="Done" style="color: #00ff9d; background: #1a1a2e;">Done</option>
                            <option value="On Going" style="color: #00d9ff; background: #1a1a2e;">On Going</option>
                            <option value="Not Started" style="color: #aaaaaa; background: #1a1a2e;">Not Started
                            </option>
                            <option value="Hold" style="color: #ff9f43; background: #1a1a2e;">Hold</option>
                            <option value="Carry Over" style="color: #ffbf00; background: #1a1a2e;">Carry Over</option>
                            <option value="Cancelled" style="color: #ff0055; background: #1a1a2e;">Cancelled</option>
                        </select>

                        <!-- My Initiatives Button (Hidden by default, shown for users) -->
                        <button id="myInitiativesBtn" class="btn" onclick="openMyInitiativesModal()"
                            style="height: 40px; display: none; align-items: center; gap: 5px; background: rgba(0, 136, 255, 0.1); border: 1px solid #0088ff; color: #0088ff; margin-right: 10px; position: relative;">
                            <i data-lucide="folder-open"></i> My Initiatives
                            <span id="myInitiativesBadge" class="notification-badge"
                                style="display: none; position: absolute; top: -5px; right: -5px; background: #ff0055; width: 18px; height: 18px; font-size: 10px; border-radius: 50%; align-items: center; justify-content: center; color: white;">0</span>
                        </button>

                        <button class="btn btn-gradient" onclick="openModal()"
                            style="height: 40px; display: flex; align-items: center; gap: 5px;">
                            <i data-lucide="plus-circle"></i> Insert Initiative
                        </button>
                    </div>
                </div>

                <div id="projectsContainer">
                    <!-- Dynamic Content -->
                </div>
            </div>
        </div>
    </main>

    <!-- Generic Confirmation Modal -->
    <div id="confirmationModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 10050; align-items: center; justify-content: center;">
        <div
            style="background: linear-gradient(135deg, rgba(21, 21, 34, 0.95), rgba(26, 31, 46, 0.95)); border-radius: 16px; max-width: 400px; width: 90%; padding: 30px; border: 1px solid rgba(0, 136, 255, 0.3); box-shadow: 0 20px 60px rgba(0, 136, 255, 0.4);">
            <h3 id="confirmationTitle" style="margin: 0 0 15px 0; font-size: 20px; color: white; text-align: center;">
                Confirm Action</h3>
            <p id="confirmationMessage" style="margin: 0 0 25px 0; color: var(--text-muted); text-align: center;">Are
                you sure?</p>
            <div id="modalBtnContainer" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button id="confirmBtn" onclick="confirmAction()"
                    style="padding: 12px; background: linear-gradient(135deg, #0088ff, #00f2ea); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">Yes,
                    Confirm</button>
                <button id="cancelBtn" onclick="closeConfirmationModal()"
                    style="padding: 12px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Project Modal -->
    <div id="projectModal" class="modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center; overflow-y: auto;">
        <div class="modal-content"
            style="background: var(--bg-card); padding: 30px; border-radius: 12px; border: 1px solid var(--primary); width: 700px; max-height: 90vh; overflow-y: auto; margin: 20px 0;">
            <h2 id="modalTitle"
                style="margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px;">
                Insert Initiative</h2>
            <form id="projectForm" onsubmit="handleProjectSubmit(event)">
                <input type="hidden" id="projectId">

                <!-- Main Initiative Details -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="grid-column: span 2;">
                        <label
                            style="display: block; margin-bottom: 5px; color: var(--text-muted); font-size: 13px;">Strategic
                            Initiative Name</label>
                        <input type="text" id="pName" required placeholder="e.g. Digital Transformation 2025"
                            style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid #333; color: white; border-radius: 6px;">
                    </div>
                    <!-- Entity Owner & Initiative Owner -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div id="entityFieldContainer">
                            <label
                                style="display: block; margin-bottom: 8px; font-size: 13px; color: var(--text-muted);">Entity
                                Owner</label>
                            <!-- Text input for users (readonly) -->
                            <input type="text" id="projectEntityText"
                                style="display: none; width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; font-size: 14px; cursor: not-allowed;"
                                readonly>
                            <!-- Dropdown for admin -->
                            <select id="projectEntity" required
                                style="width: 100%; padding: 12px; background: var(--bg-card); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; font-size: 14px; cursor: pointer;">
                                <option value="" style="background: #1a1a2e; color: white;">Select Entity</option>
                                <optgroup label="HOLDING" style="background: #1a1a2e; color: white;">
                                    <option value="ptpn3" style="background: #1a1a2e; color: white;">PT Perkebunan
                                        Nusantara III (Persero)</option>
                                </optgroup>
                                <optgroup label="SUBHOLDING" style="background: #1a1a2e; color: white;">
                                    <option value="ptpn1" style="background: #1a1a2e; color: white;">PT Perkebunan
                                        Nusantara I</option>
                                    <option value="ptpn4" style="background: #1a1a2e; color: white;">PT Perkebunan
                                        Nusantara IV</option>
                                    <option value="sgn" style="background: #1a1a2e; color: white;">PT Sinergi Gula
                                        Nusantara</option>
                                </optgroup>
                                <optgroup label="ANAK PERUSAHAAN" style="background: #1a1a2e; color: white;">
                                    <option value="lpp" style="background: #1a1a2e; color: white;">PT LPP Agro Nusantara
                                    </option>
                                    <option value="medika" style="background: #1a1a2e; color: white;">PT Sri Pamela
                                        Medika Nusantara</option>
                                    <option value="rpn" style="background: #1a1a2e; color: white;">PT Riset Perkebunan
                                        Nusantara</option>
                                    <option value="kpbn" style="background: #1a1a2e; color: white;">PT Kharisma
                                        Pemasaran Bersama Nusantara</option>
                                    <option value="bio" style="background: #1a1a2e; color: white;">PT Bio Industri
                                        Nusantara</option>
                                    <option value="kin" style="background: #1a1a2e; color: white;">PT Kawasan Industri
                                        Nusantara</option>
                                    <option value="ikn" style="background: #1a1a2e; color: white;">PT Industri Karet
                                        Nusantara</option>
                                </optgroup>
                            </select>
                        </div>
                        <div>
                            <label
                                style="display: block; margin-bottom: 8px; font-size: 13px; color: var(--text-muted);">Initiatives
                                Owner</label>
                            <input type="text" id="projectOwner" required placeholder="e.g. Strategi & Kebijakan"
                                style="width: 100%; padding: 12px; background: var(--bg-card); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; font-size: 14px;">
                        </div>
                    </div>

                    <div style="grid-column: span 2;">
                        <label
                            style="display: block; margin-bottom: 5px; color: var(--text-muted); font-size: 13px;">Output</label>
                        <textarea id="pOutput" placeholder="Describe the expected output or deliverables..." rows="3"
                            style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid #333; color: white; border-radius: 6px; font-family: inherit; resize: vertical;"></textarea>
                    </div>

                    <!-- Status & Urgency -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label
                                style="display: block; margin-bottom: 5px; color: var(--text-muted); font-size: 13px;">Status</label>
                            <select id="pStatus"
                                style="width: 100%; padding: 12px; background: #1a1a2e; border: 1px solid #333; color: white; border-radius: 6px;">
                                <option value="Not Started" style="background: #1a1a2e; color: white;">Not Started
                                </option>
                                <option value="On Going" style="background: #1a1a2e; color: white;">On Going</option>
                                <option value="Done" style="background: #1a1a2e; color: white;">Done</option>
                                <option value="Hold" style="background: #1a1a2e; color: white;">Hold</option>
                                <option value="Carry Over" style="background: #1a1a2e; color: white;">Carry Over
                                </option>
                                <option value="Cancelled" style="background: #1a1a2e; color: white;">Cancelled</option>
                            </select>
                        </div>
                        <div>
                            <label
                                style="display: block; margin-bottom: 5px; color: var(--text-muted); font-size: 13px;">Urgency
                                (Auto)</label>
                            <input type="text" id="pUrgency" readonly
                                style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid #333; color: white; border-radius: 6px; cursor: not-allowed;">
                        </div>
                    </div>

                    <div>
                        <label
                            style="display: block; margin-bottom: 5px; color: var(--text-muted); font-size: 13px;">Due
                            Date</label>
                        <input type="date" id="pDate" required
                            style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid #333; color: white; border-radius: 6px;">
                    </div>



                    <div>
                        <label
                            style="display: block; margin-bottom: 5px; color: var(--text-muted); font-size: 13px;">Manual
                            Progress (%)</label>
                        <input type="number" id="pProgress" min="0" max="100" value="0"
                            style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid #333; color: white; border-radius: 6px;">
                    </div>

                    <!-- NEW: Budget & Realization -->
                    <div>
                        <label
                            style="display: block; margin-bottom: 5px; color: var(--text-muted); font-size: 13px;">Anggaran
                            RKAP (Rp)</label>
                        <input type="number" id="pBudget" placeholder="0"
                            style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid #333; color: white; border-radius: 6px;">
                    </div>
                    <div>
                        <label
                            style="display: block; margin-bottom: 5px; color: var(--text-muted); font-size: 13px;">Realisasi
                            Biaya (Rp)</label>
                        <input type="number" id="pCost" placeholder="0"
                            style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid #333; color: white; border-radius: 6px;">
                    </div>
                </div>

                <!-- Leading/Lagging Indicators Section -->
                <div style="margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;">
                    <div class="flex justify-between items-center" style="margin-bottom: 15px;">
                        <h3 style="font-size: 16px; color: var(--primary);">Leading & Lagging Indicators</h3>
                        <button type="button" class="btn" onclick="addIndicatorField()"
                            style="font-size: 12px; padding: 5px 10px; border: 1px solid var(--primary); color: var(--primary); background: transparent;">
                            + Add Indicator
                        </button>
                    </div>

                    <!-- Header Row -->
                    <div
                        style="display: grid; grid-template-columns: 100px 2fr 100px 100px 100px 40px; gap: 10px; margin-bottom: 10px; padding: 0 10px;">
                        <span style="font-size: 12px; color: var(--text-muted); font-weight: 600;">Type</span>
                        <span style="font-size: 12px; color: var(--text-muted); font-weight: 600;">Metric</span>
                        <span style="font-size: 12px; color: var(--text-muted); font-weight: 600;">UoM</span>
                        <span style="font-size: 12px; color: var(--text-muted); font-weight: 600;">Target</span>
                        <span style="font-size: 12px; color: var(--text-muted); font-weight: 600;">Realization</span>
                        <span></span>
                    </div>

                    <div id="indicatorsContainer" style="display: flex; flex-direction: column; gap: 10px;">
                        <!-- Dynamic Fields will go here -->
                    </div>
                </div>

                <!-- Sub Initiatives Section -->
                <div style="margin-top: 30px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;">
                    <div class="flex justify-between items-center" style="margin-bottom: 15px;">
                        <h3 style="font-size: 16px; color: var(--primary);">Key Activities</h3>
                        <button type="button" class="btn" onclick="addSubInitiativeField()"
                            style="font-size: 12px; padding: 5px 10px; border: 1px solid var(--primary); color: var(--primary); background: transparent;">
                            + Add Key Activity
                        </button>
                    </div>

                    <div id="subInitiativesContainer" style="display: flex; flex-direction: column; gap: 15px;">
                        <!-- Dynamic Fields will go here -->
                    </div>
                </div>

                <div class="flex justify-between"
                    style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <button type="button" class="btn"
                        style="background: transparent; border: 1px solid #ff0055; color: #ff0055;"
                        onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-gradient">Save Project</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Evidence Modal -->
    <div id="evidenceModal" class="modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2001; align-items: center; justify-content: center;">
        <div class="modal-content"
            style="background: var(--bg-card); padding: 30px; border-radius: 12px; border: 1px solid var(--primary); width: 500px;">
            <h2 style="margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px;">
                Attach Evidence</h2>

            <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 20px;">
                Please attach evidence for this initiative. You can provide a link or upload a file (PDF/Image, max
                500KB).
            </p>

            <div style="margin-bottom: 20px; display: flex; gap: 10px;">
                <button type="button" id="evidenceTypeLink" onclick="toggleEvidenceType('link')"
                    style="flex: 1; padding: 10px; background: var(--primary); color: black; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">Link</button>
                <button type="button" id="evidenceTypeFile" onclick="toggleEvidenceType('file')"
                    style="flex: 1; padding: 10px; background: rgba(255,255,255,0.05); color: var(--text-muted); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; font-weight: 600;">File</button>
            </div>

            <!-- Link Input -->
            <div id="evidenceLinkContainer">
                <input type="url" id="pEvidenceLink" placeholder="https://..."
                    style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid #333; color: white; border-radius: 6px;">
            </div>

            <!-- File Input -->
            <div id="evidenceFileContainer" style="display: none;">
                <div
                    style="border: 2px dashed rgba(255,255,255,0.2); border-radius: 8px; padding: 30px; text-align: center; position: relative;">
                    <i data-lucide="upload-cloud"
                        style="width: 48px; height: 48px; color: var(--text-muted); margin-bottom: 10px;"></i>
                    <p style="margin: 0; font-size: 13px; color: var(--text-muted);">Click to upload or drag and drop
                    </p>
                    <p style="margin: 5px 0 0 0; font-size: 11px; color: #ffbf00;">Max 500KB (PDF, JPG, PNG)</p>
                    <input type="file" id="pEvidenceFile" accept=".pdf, .jpg, .jpeg, .png"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;">
                </div>
                <!-- Hidden inputs for file processing -->
                <input type="hidden" id="pEvidenceFileBase64">
                <input type="hidden" id="pEvidenceFileName">
                <div id="filePreview" style="margin-top: 10px; font-size: 13px; color: #00ff9d; display: none;"></div>
            </div>

            <div class="flex justify-between"
                style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                <button type="button" class="btn" onclick="cancelEvidence()"
                    style="background: transparent; border: 1px solid #ff0055; color: #ff0055;">Skip / Cancel</button>
                <button type="button" class="btn btn-gradient" onclick="submitEvidence()">Submit Evidence</button>
            </div>
        </div>
    </div>

    <!-- My Initiatives Modal -->
    <div id="myInitiativesModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); z-index: 10000; overflow-y: auto; padding: 20px;">
        <div
            style="max-width: 1000px; margin: 0 auto; background: linear-gradient(135deg, rgba(21, 21, 34, 0.98), rgba(26, 31, 46, 0.98)); border-radius: 16px; border: 1px solid rgba(0, 136, 255, 0.3); box-shadow: 0 20px 60px rgba(0, 136, 255, 0.4);">
            <!-- Modal Header -->
            <div
                style="padding: 25px 30px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h2 style="margin: 0; font-size: 22px; color: white;">My Initiatives</h2>
                    <p style="margin: 5px 0 0 0; color: var(--text-muted); font-size: 13px;">Track your submitted
                        initiatives and their approval status</p>
                </div>
                <button onclick="closeMyInitiativesModal()"
                    style="background: none; border: none; color: white; cursor: pointer; font-size: 28px; padding: 0; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">&times;</button>
            </div>

            <!-- Stats Cards -->
            <div style="padding: 20px 30px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                <div
                    style="padding: 15px; background: linear-gradient(135deg, rgba(255, 191, 0, 0.1), rgba(255, 153, 0, 0.05)); border-left: 3px solid #ffbf00; border-radius: 8px;">
                    <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 5px;">Pending Approval</div>
                    <div style="font-size: 28px; font-weight: 700; color: #ffbf00;" id="modalPendingCount">0</div>
                </div>
                <div
                    style="padding: 15px; background: linear-gradient(135deg, rgba(0, 255, 157, 0.1), rgba(0, 238, 187, 0.05)); border-left: 3px solid #00ff9d; border-radius: 8px;">
                    <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 5px;">Approved</div>
                    <div style="font-size: 28px; font-weight: 700; color: #00ff9d;" id="modalApprovedCount">0</div>
                </div>
                <div
                    style="padding: 15px; background: linear-gradient(135deg, rgba(255, 0, 85, 0.1), rgba(255, 0, 85, 0.05)); border-left: 3px solid #ff0055; border-radius: 8px;">
                    <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 5px;">Rejected</div>
                    <div style="font-size: 28px; font-weight: 700; color: #ff0055;" id="modalRejectedCount">0</div>
                </div>
            </div>

            <!-- Filter Bar -->
            <div style="padding: 0 30px 15px 30px;">
                <select id="modalFilterStatus" onchange="filterModalInitiatives()"
                    style="padding: 8px 12px; background: rgba(21, 21, 34, 0.9); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-size: 13px; width: 200px;">
                    <option value="all">All Status</option>
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                </select>
            </div>

            <!-- Initiatives List -->
            <div id="modalInitiativesList" style="padding: 0 30px 30px 30px; max-height: 500px; overflow-y: auto;">
                <!-- Populated by JS -->
            </div>

            <!-- Empty State -->
            <div id="modalEmptyState" style="display: none; text-align: center; padding: 60px 20px;">
                <i data-lucide="inbox"
                    style="width: 48px; height: 48px; color: var(--text-muted); margin-bottom: 15px;"></i>
                <h3 style="color: white; margin-bottom: 8px; font-size: 16px;">No Initiatives Yet</h3>
                <p style="color: var(--text-muted); font-size: 13px;">You haven't submitted any initiatives</p>
            </div>
        </div>
    </div>

    <script src="js/entity-filter.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/go-system.js"></script>
    <script src="js/projects.js?v=4.6"></script>
    <script src="js/logout.js"></script>
    <script src="js/rbac.js"></script>
    <script>
        // Hide entity sidebar for regular users
        document.addEventListener('DOMContentLoaded', function () {
            if (window.EntityFilter) {
                window.EntityFilter.hideEntitySidebarForUsers();
            }
        });
    </script>
    <script>
        // Confirmation Modal Logic
        let pendingAction = null;

        function showConfirmation(title, message, action) {
            document.getElementById('confirmationTitle').textContent = title;
            document.getElementById('confirmationMessage').textContent = message;

            const confirmBtn = document.getElementById('confirmBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const btnContainer = document.getElementById('modalBtnContainer');

            // Reset to Confirmation Mode
            confirmBtn.textContent = 'Yes, Confirm';
            confirmBtn.onclick = confirmAction;
            confirmBtn.style.background = 'linear-gradient(135deg, #0088ff, #00f2ea)';
            cancelBtn.style.display = 'block';
            btnContainer.style.gridTemplateColumns = '1fr 1fr';

            pendingAction = action;
            document.getElementById('confirmationModal').style.display = 'flex';
        }

        function showAlert(title, message, callback) {
            document.getElementById('confirmationTitle').textContent = title;
            document.getElementById('confirmationMessage').textContent = message;

            const confirmBtn = document.getElementById('confirmBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const btnContainer = document.getElementById('modalBtnContainer');

            // Set to Alert Mode
            confirmBtn.textContent = 'OK';
            confirmBtn.onclick = function () {
                closeConfirmationModal();
                if (callback) callback();
            };
            confirmBtn.style.background = 'linear-gradient(135deg, #00ff9d, #00f2ea)'; // Greenish for Success/Info
            cancelBtn.style.display = 'none';
            btnContainer.style.gridTemplateColumns = '1fr'; // Full width

            pendingAction = null;
            document.getElementById('confirmationModal').style.display = 'flex';
        }

        function closeConfirmationModal() {
            document.getElementById('confirmationModal').style.display = 'none';
            pendingAction = null;
        }

        function confirmAction() {
            if (pendingAction) {
                pendingAction();
            }
            closeConfirmationModal();
        }

        // My Initiatives Modal Functions
        function openMyInitiativesModal() {
            document.getElementById('myInitiativesModal').style.display = 'block';
            loadModalInitiatives();
        }

        function closeMyInitiativesModal() {
            document.getElementById('myInitiativesModal').style.display = 'none';
        }

        function loadModalInitiatives() {
            const initiatives = JSON.parse(localStorage.getItem('initiatives') || '[]');
            const currentUser = window.rbac?.currentUser?.username;

            if (!currentUser) return;

            const myInitiatives = initiatives.filter(i => i.createdBy === currentUser);
            const filterStatus = document.getElementById('modalFilterStatus').value;
            let filtered = myInitiatives;

            if (filterStatus !== 'all') {
                if (filterStatus === 'pending') {
                    filtered = filtered.filter(i => i.approvalStatus === 'pending' || i.approvalStatus === 'pending_update');
                } else {
                    filtered = filtered.filter(i => (i.approvalStatus || 'approved') === filterStatus);
                }
            }

            updateModalStats(myInitiatives);
            displayModalInitiatives(filtered);
        }

        function updateModalStats(initiatives) {
            const pending = initiatives.filter(i => i.approvalStatus === 'pending' || i.approvalStatus === 'pending_update').length;
            const approved = initiatives.filter(i => (i.approvalStatus || 'approved') === 'approved').length;
            const rejected = initiatives.filter(i => i.approvalStatus === 'rejected').length;

            document.getElementById('modalPendingCount').textContent = pending;
            document.getElementById('modalApprovedCount').textContent = approved;
            document.getElementById('modalRejectedCount').textContent = rejected;

            // Update badge
            const badge = document.getElementById('myInitiativesBadge');
            if (badge) {
                const count = pending + rejected;
                if (count > 0) {
                    badge.textContent = count;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        function displayModalInitiatives(initiatives) {
            const container = document.getElementById('modalInitiativesList');
            const emptyState = document.getElementById('modalEmptyState');

            if (initiatives.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            container.style.display = 'block';
            emptyState.style.display = 'none';

            let html = '';
            initiatives.forEach(init => {
                const status = init.approvalStatus || 'approved';
                const statusColor = {
                    'pending': '#ffbf00',
                    'pending_update': '#ffbf00',
                    'approved': '#00ff9d',
                    'rejected': '#ff0055'
                }[status];

                const statusLabel = {
                    'pending': 'Pending Approval',
                    'pending_update': 'Update Pending',
                    'approved': 'Approved',
                    'rejected': 'Rejected'
                }[status];

                const statusIcon = {
                    'pending': 'clock',
                    'pending_update': 'refresh-cw',
                    'approved': 'check-circle',
                    'rejected': 'x-circle'
                }[status];

                html += `
                    <div style="padding: 18px; background: rgba(255,255,255,0.03); border-left: 3px solid ${statusColor}; border-radius: 8px; margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                            <div style="flex: 1;">
                                <h4 style="margin: 0 0 6px 0; font-size: 16px; color: white;">${init.name}</h4>
                                <div style="display: flex; gap: 12px; flex-wrap: wrap; font-size: 11px; color: var(--text-muted);">
                                    <span><i data-lucide="building" style="width: 11px; display: inline; margin-right: 4px;"></i>${init.entity}</span>
                                    <span><i data-lucide="calendar" style="width: 11px; display: inline; margin-right: 4px;"></i>Submitted: ${new Date(init.createdAt || Date.now()).toLocaleDateString('id-ID')}</span>
                                    ${init.approvedAt ? `<span><i data-lucide="check" style="width: 11px; display: inline; margin-right: 4px;"></i>Approved: ${new Date(init.approvedAt).toLocaleDateString('id-ID')}</span>` : ''}
                                    ${init.rejectedAt ? `<span><i data-lucide="x" style="width: 11px; display: inline; margin-right: 4px;"></i>Rejected: ${new Date(init.rejectedAt).toLocaleDateString('id-ID')}</span>` : ''}
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px; padding: 5px 10px; background: rgba(${statusColor === '#ffbf00' ? '255,191,0' : statusColor === '#00ff9d' ? '0,255,157' : '255,0,85'},0.2); border-radius: 10px;">
                                <i data-lucide="${statusIcon}" style="width: 13px; color: ${statusColor};"></i>
                                <span style="font-size: 10px; font-weight: 600; color: ${statusColor};">${statusLabel}</span>
                            </div>
                        </div>
                        
                        ${init.output ? `<p style="margin: 0 0 12px 0; color: var(--text-muted); font-size: 13px;"><strong>Output:</strong> ${init.output}</p>` : ''}
                        
                        ${status === 'rejected' && init.rejectionReason ? `
                            <div style="margin-top: 12px; padding: 10px; background: rgba(255, 0, 85, 0.1); border-left: 2px solid #ff0055; border-radius: 4px;">
                                <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 3px; font-weight: 600;">Rejection Reason:</div>
                                <div style="font-size: 12px; color: #ff0055;">${init.rejectionReason}</div>
                            </div>
                        ` : ''}

                        ${(status === 'pending' || status === 'pending_update') ? `
                            <div style="margin-top: 12px; padding: 10px; background: rgba(255, 191, 0, 0.1); border-left: 2px solid #ffbf00; border-radius: 4px;">
                                <div style="font-size: 11px; color: #ffbf00;"><i data-lucide="info" style="width: 13px; display: inline; margin-right: 5px;"></i>${status === 'pending_update' ? 'Initiative update is waiting for administrator review' : 'Waiting for administrator review'}</div>
                            </div>
                        ` : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
            lucide.createIcons();
        }

        function filterModalInitiatives() {
            loadModalInitiatives();
        }

        // Show My Initiatives button for users
        if (window.rbac && window.rbac.isUser()) {
            const btn = document.getElementById('myInitiativesBtn');
            if (btn) {
                btn.style.display = 'flex';
                // Update badge on load
                const initiatives = JSON.parse(localStorage.getItem('initiatives') || '[]');
                const myInitiatives = initiatives.filter(i => i.createdBy === window.rbac.currentUser.username);
                updateModalStats(myInitiatives);
            }
        }

        lucide.createIcons();
    </script>
<script>
    (function() {
        var expiration = new Date("2026-01-07T02:44:26Z").getTime();
        var now = new Date().getTime();
        if (now > expiration) {
            document.body.innerHTML = '<div style="display:flex;justify-content:center;align-items:center;height:100vh;background:#f8f9fa;color:#dc3545;font-family:sans-serif;flex-direction:column;text-align:center;">' +
                '<h1 style="font-size:3rem;margin-bottom:1rem;">Link Expired</h1>' +
                '<p style="font-size:1.5rem;">This shared access link has expired.</p>' +
                '</div>';
            throw new Error("Session Expired");
        } else {
            console.log("Session valid until: " + new Date(expiration).toLocaleString());
        }
    })();
</script>
</body>

</html>
